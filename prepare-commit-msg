#!/usr/bin/python3

import json
import sys


with open(".git/hooks/data.json") as f:
    data = json.load(f)

commit_msg_filepath = sys.argv[1]

prefixes = [*data.keys()]

final_prefixes = [f"{emoji} {prefix}" for prefix, emoji in data.items()]

with open(commit_msg_filepath, "r+") as f:
    content = f.read()

    try:
        prefix = content.split(":")[0]
    except IndexError:
        print(
            "The commit message must follow the following format: [prefix]: [message]"
        )
        sys.exit(1)

    if prefix in final_prefixes:
        sys.exit(0)

    try:
        emoji = data[prefix]

        if prefix not in prefixes or emoji not in prefix:
            pass

        f.seek(0, 0)

        f.write(f"{emoji} {content}")

    except KeyError as e:
        print(f"Unknown prefix: {prefix}")
        sys.exit(1)

    except Exception as e:
        print(f"Error: {e.__class__}")
        sys.exit(1)
